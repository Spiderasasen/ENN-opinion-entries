const apiKey = process.env.RESEND_API_KEY;

export default async function handler(req, res) {
    if (req.method === "POST") {
        const data = req.body;
        console.log("Received:", data);

        const { name, email, header, subheader, body, media } = data;
        const emailPayload = {
            from: "onboarding@resend.dev",
            to: "ddiaz11@elon.edu",
            subject: `New Opinion Submission from ${name}`,
            text: `
                User: ${name}, ${email}
                Header: ${header}
                Subheader: ${subheader}
                Media: ${media}
                Main Draft: ${body}
            `
        };

        // This is the missing part â€” actually sending the email!
        const response = await fetch("https://api.resend.com/emails", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${apiKey}`,
                "Content-Type": "application/json",
            },
            body: JSON.stringify(emailPayload),
        });

        const result = await response.json();

        if (!response.ok) {
            return res.status(500).json({ error: result });
        }

        return res.status(200).json({ message: "Email Sent!!", id: result.id });
    }

    return res.status(405).json({ message: "Method not allowed" });
}